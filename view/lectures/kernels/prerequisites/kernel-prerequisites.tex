%%
%% licence       kaneton licence
%%
%% project       kaneton
%%
%% file          /home/buckman/kaneton/view/lectures/kernels/prerequisites/kernel-prerequisites.tex
%%

%
% template
%

\input{../../../templates/lecture.tex}

%
% title
%

\title{Kernels - Prerequisites}

%
% authors
%

\author
{
  Matthieu~Bucchianeri and Renaud~Voltz\inst{1}
}

%
% figures
%

%
%\pgfdeclareimage[interpolate=true,width=188pt,height=97pt]
%                {sample}
%		{figures/sample}

% bsd

\pgfdeclareimage[interpolate=true,width=157pt,height=120pt]
                {bsd}
		{figures/bsd}

% kaneton

\pgfdeclareimage[interpolate=true,width=145pt,height=120pt]
                {kaneton}
		{figures/kaneton}

% lseos

\pgfdeclareimage[interpolate=true,width=174pt,height=120pt]
                {lseos}
		{figures/lseos}

% hexo

\pgfdeclareimage[interpolate=true,width=176pt,height=120pt]
                {hexo}
		{figures/hexo}

% nt

\pgfdeclareimage[interpolate=true,width=194pt,height=120pt]
                {nt}
		{figures/nt}

% k

\pgfdeclareimage[interpolate=true,width=151pt,height=120pt]
                {k}
		{figures/k}

% basic architecture

\pgfdeclareimage[interpolate=true,width=158pt,height=150pt]
                {arch-basic}
		{figures/arch-basic}

% memory access

\pgfdeclareimage[interpolate=true,width=240pt,height=200pt]
                {memory-access-step1}
		{figures/memory-access-step1}
\pgfdeclareimage[interpolate=true,width=240pt,height=200pt]
                {memory-access-step2}
		{figures/memory-access-step2}
\pgfdeclareimage[interpolate=true,width=240pt,height=200pt]
                {memory-access-step3}
		{figures/memory-access-step3}
\pgfdeclareimage[interpolate=true,width=240pt,height=200pt]
                {memory-access-step4}
		{figures/memory-access-step4}

% io

\pgfdeclareimage[interpolate=true,width=261pt,height=180pt]
                {io-step1}
		{figures/io-step1}
\pgfdeclareimage[interpolate=true,width=261pt,height=180pt]
                {io-step2}
		{figures/io-step2}
\pgfdeclareimage[interpolate=true,width=261pt,height=180pt]
                {io-step3}
		{figures/io-step3}


% irq reception

\pgfdeclareimage[interpolate=true,width=225pt,height=180pt]
                {irq-step1}
		{figures/irq-step1}
\pgfdeclareimage[interpolate=true,width=225pt,height=180pt]
                {irq-step2}
		{figures/irq-step2}
\pgfdeclareimage[interpolate=true,width=225pt,height=180pt]
                {irq-step3}
		{figures/irq-step3}
\pgfdeclareimage[interpolate=true,width=225pt,height=180pt]
                {irq-step4}
		{figures/irq-step4}

% pipeline

\pgfdeclareimage[interpolate=true,width=300pt,height=141pt]
                {pipeline}
		{figures/pipeline}

% rob

\pgfdeclareimage[interpolate=true,width=307pt,height=180pt]
                {rob}
		{figures/rob}

% caches

\pgfdeclareimage[interpolate=true,width=244pt,height=180pt]
                {cache}
		{figures/cache}
\pgfdeclareimage[interpolate=true,width=244pt,height=180pt]
                {cache-step1}
		{figures/cache-step1}
\pgfdeclareimage[interpolate=true,width=244pt,height=180pt]
                {cache-step2}
		{figures/cache-step2}
\pgfdeclareimage[interpolate=true,width=244pt,height=180pt]
                {cache-step3}
		{figures/cache-step3}
\pgfdeclareimage[interpolate=true,width=244pt,height=180pt]
                {cache-step4}
		{figures/cache-step4}
\pgfdeclareimage[interpolate=true,width=244pt,height=180pt]
                {cache-step5}
		{figures/cache-step5}

% mmu

\pgfdeclareimage[interpolate=true,width=211pt,height=80pt]
                {mmu}
		{figures/mmu}


%
% document
%

\begin{document}

%
% title frame
%

\begin{frame}
  \titlepage

  \begin{center}
    \logos
  \end{center}
\end{frame}

%
% outline frame
%

\begin{frame}
  \frametitle{Outline}
  \tableofcontents
\end{frame}

%
% introduction to kernels
%

\section{Introduction to kernels}

%
% roles of a kernel
%

\subsection{Roles of a kernel}

\begin{frame}
  \frametitle{Finalité}

  XXX

\end{frame}

\begin{frame}
  \frametitle{Fonctionnement interne /detail parties /gestionnaires...}

  XXX

\end{frame}

%
% monolithic kernels
%

\subsection{Monolithic kernels}

%
% monolithic kernels
%

\begin{frame}
  \frametitle{Monolithic kernels}

  XXX

\end{frame}

%
% bsd
%

\begin{frame}
  \frametitle{Example: BSD}

  4.4BSD kernel include all functionnalities in kernel-land: from
    process management to network layer, through filesystems.

  \begin{center}
    \pgfuseimage{bsd}
  \end{center}

  The kernel is about 200.000 lines long.

\end{frame}

%
% microkernels
%

\subsection{Micro-kernels}

%
% microkernels
%

\begin{frame}
  \frametitle{Micro-kernels}

  XXX

\end{frame}

%
% kaneton
%

\begin{frame}
  \frametitle{Example: kaneton}

  kaneton provide a dozen of critical managers: memory, process,
  I/O\ldots{} Only these functionnalities are running in kernel-land.

  \begin{center}
    \pgfuseimage{kaneton}
  \end{center}

  Advanced functionnalities (filesystems, network\ldots) are provided
  by services in userland. IPC are omnipresent.

\end{frame}

%
% nanokernels
%

\subsection{Nano-kernels}

%
% nanokernels
%

\begin{frame}
  \frametitle{Nano-kernels}

  XXX

\end{frame}

%
% lse/os
%

\begin{frame}
  \frametitle{Example: LSE/OS}

  LSE/OS has a nano-kernel conception to keep the code as tiny as
  possible, preventing bugs into the kernel leading to global crashed
  of the system. Only the core is running in kernel-land.

  \begin{center}
    \pgfuseimage{lseos}
  \end{center}

  LSE/OS pushes out of the kernel the timer and interrupt controller
  modules and offers minimal services for task and memory management.

\end{frame}

%
% exokernels
%

\subsection{Exo-kernels}

%
% exokernels
%

\begin{frame}
  \frametitle{Exo-kernels}

  Exo-kernels is a very young class of kernel, still under research
  effort. Principles:

  \begin{itemize}
  \item
    A few abstraction as possible
  \item
    Abstractions are libraries
  \item
    Build other abstractions on existing one
  \item
    Programs use directly these abstractions for performances
  \end{itemize}

  \-

  No commercial operating systems are based on exo-kernel.

\end{frame}

%
% hexo
%

\begin{frame}
  \frametitle{Example: HEXO}

  HEXO is a massively parallel heterogeneous multiprocessor
  exo-kernel.

  \begin{center}
    \pgfuseimage{hexo}
  \end{center}

  HEXO is build over two abstractions : CPU-specific and
  Platform-specific. Higher level abstractions can be wrote easily
  over HEXO's primitives.

\end{frame}

%
% hybrid kernels
%

\subsection{Hybrid kernels}

%
% hybrid kernels
%

\begin{frame}
  \frametitle{Hybrid kernels}

  The hybrid kernels relies on all the previously studied kernel
  models.

  \begin{itemize}
  \item
    Structure similar to micro-kernels, with services
  \item
    Most of the code is running in kernel-land to improve performance,
    like in monolithic kernels
  \end{itemize}

  This class of kernels is considered as ``marketing argument'' by
  many people, because there is no great innovation.

\end{frame}

%
% windows nt
%

\begin{frame}
  \frametitle{Example: Windows NT}

  \begin{center}
    \pgfuseimage{nt}
  \end{center}

  The NT kernel is a mix of exo-kernels (HAL), micro-kernels
  (services) and monolithic kernels (everything in kernel-land). On
  Windows NT, it is fun to notice that even the GUI services are part
  of the kernel.

\end{frame}

%
% specific kernels
%

\begin{frame}
  \frametitle{Specific kernels}

  Specific kernels are dedicated to specific domains and applications.

  \begin{itemize}
  \item
    Some of the classical functionnalities are not provided
  \item
    Important drivers are directly included into the kernel
  \item
    No portability
  \item
    Reduced set of system calls
  \item
    Non-standard API (specific API)
  \end{itemize}

  \-

  For example, the operating system of a washing machine does not need
  virtual memory, scheduler or filesystems.

\end{frame}

%
% k
%

\begin{frame}
  \frametitle{Example: K}

  K is a specific kernel providing a reduced set of functionnality. K
  is intended to run small games.

  \begin{center}
    \pgfuseimage{k}
  \end{center}

  K does not provide some classical functionnalities such as virtual
  memory or process management, but is provides some main functions
  for its specific domain like video or sound drivers.

\end{frame}

%
% recalls of prerequisites
%

\section{Recalls of prerequisites}

%
% basic architectures
%

\subsection{Basic architectures}

% -)

\begin{frame}
  \frametitle{Minimal components and buses}

  \begin{center}
    \pgfuseimage{arch-basic}
  \end{center}

\end{frame}

% -)

\begin{frame}
  \frametitle{Memory accesses}

  \begin{center}
    \pgfuseimage{memory-access-step1}
  \end{center}

\end{frame}

% -)

\begin{frame}
  \frametitle{Memory accesses}

  \begin{center}
    \pgfuseimage{memory-access-step2}
  \end{center}

\end{frame}

% -)

\begin{frame}
  \frametitle{Memory accesses}

  \begin{center}
    \pgfuseimage{memory-access-step3}
  \end{center}

\end{frame}

% -)

\begin{frame}
  \frametitle{Memory accesses}

  \begin{center}
    \pgfuseimage{memory-access-step4}
  \end{center}

\end{frame}

% -)

\begin{frame}
  \frametitle{I/Os}

  \begin{center}
    \pgfuseimage{io-step1}
  \end{center}

\end{frame}

% -)

\begin{frame}
  \frametitle{I/Os}

  \begin{center}
    \pgfuseimage{io-step2}
  \end{center}

\end{frame}

% -)

\begin{frame}
  \frametitle{I/Os}

  \begin{center}
    \pgfuseimage{io-step3}
  \end{center}

\end{frame}

% -)

\begin{frame}
  \frametitle{IRQ reception}

  \begin{center}
    \pgfuseimage{irq-step1}
  \end{center}

\end{frame}

% -)

\begin{frame}
  \frametitle{IRQ reception}

  \begin{center}
    \pgfuseimage{irq-step2}
  \end{center}

\end{frame}

% -)

\begin{frame}
  \frametitle{IRQ reception}

  \begin{center}
    \pgfuseimage{irq-step3}
  \end{center}

\end{frame}

% -)

\begin{frame}
  \frametitle{IRQ reception}

  \begin{center}
    \pgfuseimage{irq-step4}
  \end{center}

\end{frame}

% -)

\begin{frame}
  \frametitle{Bus locking}

  XXX

\end{frame}

% -)

\begin{frame}
  \frametitle{Direct Memory Access (DMA) / Bus mastering}

  XXX

\end{frame}

%
% microprocessor's internals
%

\subsection{Microprocessor's internals}

% -)

\begin{frame}
  \frametitle{General description}

  XXX

  XXX out of order, in order, superscalaire, multitreadé, multicore

\end{frame}

% -)

\begin{frame}
  \frametitle{Instructions sets}

  XXX

  XXX microcode

\end{frame}

% -)

\begin{frame}
  \frametitle{Register banks}

  XXX

\end{frame}

% -)

\begin{frame}
  \frametitle{Reserved registers and ABI}

  Few registers are reserved, either by the microprocessor itself or
  by some specifications used by compilers.

  \begin{itemize}
  \item
    Stack and Frame Pointer
  \item
    Return Value
  \item
    Return Address
  \item
    Global Storage Area
  \end{itemize}

  Example on SPARC V8 :

  \begin{center}
  \begin{tabular}{|c|c|c|}
    \hline
    Register & Description & Imposed by \\
    \hline
    g1 & global storage area & ABI \\
    \hline
    i0 & value to return & CPU \\
    \hline
    o0 & value returned & CPU \\
    \hline
    i6 & frame pointer & ABI \\
    \hline
    o6 & stack pointer & ABI \\
    \hline
    o7 & return address & CPU \\
    \hline
  \end{tabular}
  \end{center}

\end{frame}

% -)

\begin{frame}
  \frametitle{Reserved registers and ABI}

  Some registers are considered caller-save or callee-save, meaning
  they can or cannot be modified by inside functions. These rules
  depends on calling conventions.

  \-

  Example on x86 :

  \begin{center}
  \begin{tabular}{|c|c|c|}
    \hline
    Register & Is \\
    \hline
    EAX, ECX, EDX & Caller-save \\
    \hline
    EBX, ESI, EDI, EBP & Callee-save \\
    \hline
  \end{tabular}
  \end{center}

\end{frame}

% -)

\begin{frame}
  \frametitle{Execution units}

  A microprocessor is made of several execution units that can issue a
  given operation using specified operands.

  \begin{itemize}
  \item
    Arithmetic and Logic Unit (ALU), performs additions, multiplications, shifts\ldots
  \item
    Load/Store Unit, performs memory accesses
  \item
    Floating Point Unit (FPU), performs IEEE 754 operations
  \item
    Extensions, including SIMD Units
  \end{itemize}

  There can be one or more unit of each type. If there are only one
  adder and the CPU is able to execute two instructions at a time,
  these instructions cannot be both additions.

\end{frame}

% -)

\begin{frame}
  \frametitle{Very simple microprocessor}

  XXX

\end{frame}

% -)

\begin{frame}
  \frametitle{Introduction to pipelines}

  \begin{center}
    \pgfuseimage{pipeline}
  \end{center}

\end{frame}

% -)

\begin{frame}
  \frametitle{Introduction to Re-Ordering Buffer (ROB)}

  \begin{center}
    \pgfuseimage{rob}
  \end{center}

\end{frame}

% -)

\begin{frame}
  \frametitle{Memory Management Unit}

  The role of a MMU is to process ``logical'' addresses used in
  programs into ``physical'' addresses that can be accessed in RAM.

  \-

  \begin{center}
    \pgfuseimage{mmu}
  \end{center}

  Multiple kind of translation rules can be used depending on the
  processors abilities. Error and privilege checking can be used.

\end{frame}

% -)

\begin{frame}
  \frametitle{Caches}

  \begin{center}
    \pgfuseimage{cache}
  \end{center}

\end{frame}

% -)

\begin{frame}
  \frametitle{Caches}

  \begin{center}
    \pgfuseimage{cache-step1}
  \end{center}

\end{frame}

% -)

\begin{frame}
  \frametitle{Caches}

  \begin{center}
    \pgfuseimage{cache-step2}
  \end{center}

\end{frame}

% -)

\begin{frame}
  \frametitle{Caches}

  \begin{center}
    \pgfuseimage{cache-step3}
  \end{center}

\end{frame}

% -)

\begin{frame}
  \frametitle{Caches}

  \begin{center}
    \pgfuseimage{cache-step4}
  \end{center}

\end{frame}

% -)

\begin{frame}
  \frametitle{Caches}

  \begin{center}
    \pgfuseimage{cache-step5}
  \end{center}

\end{frame}

% -)

\begin{frame}
  \frametitle{Running modes}

  A microprocessor can operates in multiple modes :

  \begin{itemize}
  \item
    Kernel mode, or Privileged mode or Supervisor mode : the one used by the kernel
  \item
    User mode : to run applications
  \end{itemize}

  There can be extended mode, depending on microprocessor's
  specifications :

  \begin{itemize}
  \item
    Error recovery : to avoid crash when critical error occurs
  \item
    Halt mode : the microprocessor is executing nothing, waiting for external interrupts
  \item
    \ldots
  \end{itemize}

\end{frame}

% -)

\begin{frame}
  \frametitle{Exceptions and soft-interrupts}

  XXX

\end{frame}

% -)

\begin{frame}
  \frametitle{Hardware interrupts (IRQ)}

  XXX

\end{frame}

% -)

\begin{frame}
  \frametitle{Inter-Processor Interrupts (IPI)}

  XXX

\end{frame}

% -)

\begin{frame}
  \frametitle{Program loading}

  XXX

\end{frame}

% -)

\begin{frame}
  \frametitle{Multiprogramming}

  XXX

\end{frame}

%
% bibliography
%

\section{Bibliography}

\begin{thebibliography}{4}

%  \bibitem{ID}
%    Sample
%    \newblock Sample

\end{thebibliography}

\end{document}
