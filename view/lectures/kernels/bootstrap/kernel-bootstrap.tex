%%
%% licence       kaneton licence
%%
%% project       kaneton
%%
%% file          /home/buckman/kaneton/view/lectures/kernels/bootstrap/kernel-bootstrap.tex
%%

%
% template
%

\input{../../../templates/lecture.tex}

%
% title
%

\title{Kernels - Bootstrap}

%
% authors
%

\author
{
  Matthieu~Bucchianeri and Renaud~Voltz\inst{1}
}

%
% figures
%

%
%\pgfdeclareimage[interpolate=true,width=188pt,height=97pt]
%                {sample}
%		{figures/sample}

% openboot

\pgfdeclareimage[interpolate=true,width=232pt,height=140pt]
                {devtree}
		{figures/devtree}
\pgfdeclareimage[interpolate=true,width=222pt,height=180pt]
                {ofw}
		{figures/ofw}

%
% document
%

\begin{document}

%
% title frame
%

\begin{frame}
  \titlepage

  \begin{center}
    \logos
  \end{center}
\end{frame}

%
% outline frame
%

\begin{frame}
  \frametitle{Outline}
  \tableofcontents
\end{frame}

%
% sun's openboot
%

\begin{frame}
  \frametitle{OpenBoot (Sun)}

  OpenBoot (or OpenFirmware) is the software embedded in all Sun's
  SPARC based stations.

  \-

  OpenBoot offers many services (as the BIOS does) necessary to the
  bootup phase. For example:

  \begin{itemize}
  \item
    Device-tree exploration (\emph{sibling}, \emph{child},
    \emph{getprop}\ldots)
  \item
    Device I/O (\emph{open}, \emph{read}, \emph{write}\ldots)
  \item
    MMU (\emph{map\_phys}, \emph{unmap\_phys}, \emph{itlb\_load},
    \emph{dtlb\_load}\ldots)
  \item
    Environment (boot path, boot device, boot arguments\ldots)
  \item
    Time (\emph{milliseconds})
  \end{itemize}

  \-

  All these functionnalities make OpenBoot a tiny OS. In addition,
  OpenBoot is able to run bytecode scripts (in Forth language), to
  load ELF files from disk or network (TFTP) and to debug programs
  (disassembly, registers dump, calls trace\ldots).

\end{frame}

% -)

\begin{frame}
  \frametitle{OpenBoot device-tree example}

  \begin{center}
  \pgfuseimage{devtree}
  \end{center}

\end{frame}

% -)

\begin{frame}
  \frametitle{OpenBoot call}

  Calling OpenBoot is as simple as jumping to the so-called
  \emph{firmware entry-point} (given in register \%g7 at boot time)
  with a structure in first argument (register \%o0). This structure is
  as follow:

  \begin{itemize}
  \item
    A pointer to a string indicating the name of the function to call.
  \item
    The number of arguments \emph{N}
  \item
    The number of return values \emph{M}
  \item
    \emph{N} 64-bit arguments
  \item
    \emph{M} 64-bit slots for results
  \end{itemize}

\end{frame}

% -)

\begin{frame}
  \frametitle{OpenBoot example}

  \begin{center}
  \pgfuseimage{ofw}
  \end{center}

\end{frame}

%
% sgi's arc
%

\begin{frame}
  \frametitle{ARCS (SGI)}

  ARCS is the firmware used in all SGI MIPS-based stations. ARCS has
  also been used on a few Pentium-based stations, in replacement of
  the traditional BIOS.

  \-

  ARCS offers:

  \begin{itemize}
  \item
    Device-tree functions (\emph{GetPeer}, \emph{GetChild},
    \emph{GetComponent}\ldots)
  \item
    Device I/O (\emph{open}, \emph{read}, \emph{write}\ldots)
  \item
    Filesystem supports, FAT and ISO9660 (\emph{mount}, \emph{open},
    \emph{read}\ldots)
  \item
    Environment variables
  \item
    Time (\emph{GetTime})
  \end{itemize}

  \-

  ARCS is also able to load ELF files, from disk or network.

\end{frame}

% -)

\begin{frame}
  \frametitle{ARCS System Parameter Block}

  The System Parameter Block (SPB) is a structure filed by ARCS before
  giving the hand to the boot program. The block contains notably the
  Firmware Vector, which is an array of function pointers. Calling
  ARCS is as simple as calling the wanted function from this vector.

\end{frame}

%
% bibliography
%

\section{Bibliography}

\begin{thebibliography}{4}

%  \bibitem{ID}
%    Sample
%    \newblock Sample

\end{thebibliography}

\end{document}
