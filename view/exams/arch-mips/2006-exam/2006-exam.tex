%%
%% licence       kaneton licence
%%
%% project       kaneton
%%
%% file          /home/mycure/kaneton/view/exams/arch-mips/2006-exam/2006-exam.tex
%%
%% created       julien quintard   [fri dec  2 22:25:51 2005]
%% updated       julien quintard   [sat apr  1 17:34:48 2006]
%%

%
% template
%

\input{../../../templates/exam.tex}

%
% header
%

\lhead{\scriptsize{2006}}

%
% title
%

\title{Examen d'Architecture MIPS}

%
% authors
%

\author{\small{Julien Quintard}}

%
% document
%

\begin{document}

%
% title
%

\maketitle

%
% --------- information -------------------------------------------------------
%

\begin{center}

\textbf{Documents Autoris\'es}

\textbf{Dur\'ee 3 heures}

\scriptsize{Une copie bien pr\'esent\'ee avec des sch\'emas propres et
	    lisibles sera toujours mieux not\'ee qu'une autre.}
\end{center}

%
% --------- text --------------------------------------------------------------
%

On consid\`ere la fonction \textbf{vatican}() suivante qui effectue
l'op\'eration de \textbf{Gauss} sur une ligne \textit{j} par rapport \`a
la ligne \textit{k}.

La matrice est une matrice carr\'ee de taille \textit{size}.

\begin{verbatim}
int*            vatican(int* m,
                        unsigned int j,
                        unsigned int k,
                        unsigned int size,
                        int e)
{
  int           i;

  for (i = 0; i < size; i++)
    m[(j * size) + i] = m[(j * size) + i] - m[(k * size) + i] * e;

  return (m);
}
\end{verbatim}

Ce code f\^ut ensuite compil\'e pour une r\'ealisation \textbf{non pipeline}
du processeur MIPS. Le code assembleur produit est le suivant.

\begin{itemize}
  \item
    \textit{R5} contient l'adresse de la ligne \textit{j}.
  \item
    \textit{R6} contient l'adresse de la ligne \textit{k}.
  \item
    \textit{R7} contient l'adresse de la fin de la ligne \textit{j}.
  \item
    \textit{R8} contient le coefficient \textit{e}.
\end{itemize}

\begin{verbatim}
Loop:    Lw R9, 0(R6)
         Mul R9, R9, R8
         Lw R10, 0(R5)
         Sub R10, R10, R9
         Sw R10, 0(R5)

         Addiu R6, R6, 4
         Addiu R5, R5, 4
         Bne R5, R7, Loop
\end{verbatim}

Le processeur MIPS-9 \'etudi\'e est le suivant:

\begin{center}
  \includegraphics[scale=0.6]{figures/pipeline.pdf}
\end{center}

On suppose que ce microprocesseur dispose d'une instruction
\textit{Mul Rd, Rs, Rt} de format R. Dans cette instruction, les 32 bits
de poids faibles du r\'esultat sont rang\'es dans le registre \textit{Rd}.
Pour cette instruction, les quatre \'etage EXE, MEM-1, MEM-2 et MEM-3 sont
remplac\'es par MX-1, MX-2, MX-3 et MX-4.

%
% fonctionnement
%

\section{Fonctionnement - 2 points}

Modifier ce code de telle mani\`ere qu'il soit ex\'ecutable par le processeur
pipeline MIPS 9 \'etages.

\begin{correction}

  Il faut ajouter \textbf{3} \textit{delay slots} apr\`es chaque
  branchement.

  \begin{verbatim}
  Loop:    Lw R9, 0(R6)
           Mul R9, R9, R8
           Lw R10, 0(R5)
           Sub R10, R10, R9
           Sw R10, 0(R5)

           Addiu R6, R6, 4
           Addiu R5, R5, 4
           Bne R5, R7, Loop
           Nop
           Nop
           Nop
  \end{verbatim}

\end{correction}

%
% bypasses
%

\section{Bypasses - 4 points}

Veuillez sp\'ecifier, via une vue simplifi\'ee, les diff\'erents bypasses
que comportent ce processeur.

Pour chaque bypass vous devez d\'ecrire une s\'equence d'op\'erations
mettant en \'evidence l'utilisation d'un tel bypass.

\begin{correction}

  \begin{center}
    \includegraphics[scale=0.6]{figures/correction-bypasses.pdf}
  \end{center}

  \begin{enumerate}
    \item
      \begin{verbatim}
	Add R3, R2, R1
	Add R5, R4, R3
      \end{verbatim}
    \item
      \begin{verbatim}
	Add R3, R2, R1
	Nop
	Beq R3, R0, Loop
      \end{verbatim}
    \item
      \begin{verbatim}
	Add R3, R2, R1
	Nop
	Nop
	Beq R3, R0, Loop
      \end{verbatim}
    \item
      \begin{verbatim}
	Add R3, R2, R1
	Nop
	Nop
	Nop
	Beq R3, R0, Loop
      \end{verbatim}
    \item
      \begin{verbatim}
	Lw R3, 0(R5)
	Nop
	Nop
	Nop
	Add R5, R4, R3
      \end{verbatim}
    \item
      \begin{verbatim}
	Lw R3, 0(R5)
	Nop
	Nop
	Nop
	Nop
	Beq R3, R0, Loop
      \end{verbatim}
  \end{enumerate}

\end{correction}

%
% analyse simplifiee
%

\section{Analyse Simplifi\'ee - 5 points}

Veuillez d\'ecrire l'\'execution de la boucle de la fonction \textbf{vatican}()
\`a l'aide d'une vue simplifi\'ee.

Vous devrez ensuite calculer le CPI et CPIu.

\begin{correction}

  \begin{center}
    \includegraphics[scale=0.33]{figures/correction-analyse-simplifiee.pdf}
  \end{center}

\end{correction}

%
% optimisation
%

\section{Optimisation - 5 points}

Veuillez appliquer l'optimisation \textit{Software Pipeline} sur
la boucle de la fonction \textbf{vatican}() de mani\`ere \`a obtenir
les meilleures performances.

\begin{correction}

  \begin{verbatim}
  Loop:    Sw R11, 0(R5)

           Sub R11, R10, R9

           Lw R9, -8(R6)

           Addiu R5, R5, 4

           Lw R10, -12(R5)

           Bne R5, R7, Loop
           Mul R9, R9, R8
           Nop
           Addiu R6, R6, 4
  \end{verbatim}

\end{correction}

%
% memoire
%

\section{M\'emoire - 4 points}

\end{document}
