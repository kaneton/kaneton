\section*{Exercice 3 : Mapping sur MIPS (6 points)}

Dans cet exercice, vous allez implementer le manager \emph{region} de
kaneton pour un microprocesseur de la famille MIPS (vu en cours).

Contrairement aux microprocesseurs IA-32 qui implementent un
algorithme de remplacement automatique des entrées TLB basé sur un
arbre (la page-directory et les page-tables), le microprocesseur MIPS
R3000 n'offre aucune aide au programmeur en cas de TLB-miss.

Lorsque la MMU demande une traduction d'adresse et qu'aucune entrée
dans les TLB n'est satisfaisante, une exception est d\'eclench\'ee. C'est
alors au noyau de remplir les TLB comme il convient, ou de déclarer
une erreur fatale.

{\bf Note :} la taille des pages sur le MIPS R3000 est fixée à 4ko.


\begin{description}
\item {\bf Impl\'ementation du gestionnaire de TLB-miss}

Les TLB contiennent des entrées provenant de tous les espaces
d'adressage confondus. Ainsi, pour indiquer à quel espace d'adressage
une entrée TLB appartient, chaque entr\'ee contient un identifiant
cod\'e sur 6 bits.

\begin{enumerate}
\item Allez-vous devoir faire des modifications dans la partie dépendante de
\emph{as} ?\\
Si oui, lesquelles ?\\
\item En quoi le fait d'encoder le champ identifiant sur 6 bits peut-il
poser problème ?\\
\textbf{Pour la suite de l'exercice, vous ne devez pas consid\'erer le
        problème identifié ci-dessus.}\\


\item Ecrivez le code du gestionnaire de TLB-miss.\\
Vous vous appuyerez sur les fonctions de la biblioth\`eque MIPS et de
l'interface kaneton (voir annexe).\\
\\
Le prototype du gestionnaire de TLB-miss est le suivant :

\function{tlb\_miss}{(i\_as asid)}
{
\begin{itemize}
\item
  \emph{asid} est l'identifiant de l'espace d'adressage sur lequel
  s'est produit l'erreur
\end{itemize}
}

\item Ecrivez le code dépendant de la fonction {\em region\_release}. Vous
pouvez utiliser les fonctions de l'interface kaneton et celles de la
bibliothèque MIPS.\\
\end{enumerate}


\item {\bf Amélioration des performances (bonus)}

Indiquez pourquoi votre code n'est pas suffisament
performant. Proposez une (ou plusieurs) solution(s) pour gagner en
performances.

\end{description}
