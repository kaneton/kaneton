##
## copyright quintard julien
## 
## kaneton
## 
## machine.conf
## 
## path          /home/mycure/kaneton
## 
## made by mycure
##         quintard julien   [quinta_j@epita.fr]
## 
## started on    Fri Feb 11 02:08:31 2005   mycure
## last update   Mon Nov  7 17:45:26 2005   mycure
##

#
# ---------- information ------------------------------------------------------
# 
# this file contains the kaneton directories, librarires, binaries,
# script, tools.
#
# this file uses the makefile syntax.
#

#
# ---------- signature --------------------------------------------------------
#

_SIGNATURE_		:=		kaneton

#
# ---------- user -------------------------------------------------------------
#

_USER_			:=		$(KANETON_USER)

#
# ---------- binaries ---------------------------------------------------------
#

_SHELL_			:=		/bin/bash
_CC_			:=		gcc
_MAKE_			:=		gmake
_RM_			:=		rm -f
_PURGE_			:=		$(_RM_) *~ .*~ \#* .\#*
_AR_			:=		ar cq
_RANLIB_		:=		ranlib
_CD_			:=		cd
_LD_			:=		ld
_NASM_			:=		nasm
_LN_			:=		ln -s -f
_TOUCH_			:=		touch
_WC_			:=		wc
_TAIL_			:=		tail
_TAR_			:=		tar
_LATEX_			:=		latex
_DVIPS_			:=		dvips
_PDFLATEX_		:=		pdflatex
_CP_			:=		cp
_CAT_			:=		cat
_SED_			:=		sed
_ECHO_			:=		echo
_READ_			:=		read
_LS_			:=		ls
_DATE_			:=		date

#
# ---------- kaneton directories ----------------------------------------------
#

_CORE_DIR_		:=		$(_SRC_DIR_)/core

_CORE_BOOTSTRAP_DIR_	:=		$(_SRC_DIR_)/core/bootstrap
_CORE_BOOTLOADER_DIR_	:=		$(_SRC_DIR_)/core/bootloader
_CORE_INCLUDE_DIR_	:=		$(_SRC_DIR_)/core/include
_CORE_KANETON_DIR_	:=		$(_SRC_DIR_)/core/kaneton

_CORE_AS_DIR_		:=		$(_CORE_KANETON_DIR_)/as
_CORE_CONF_DIR_		:=		$(_CORE_KANETON_DIR_)/conf
_CORE_DEBUG_DIR_	:=		$(_CORE_KANETON_DIR_)/debug
_CORE_ID_DIR_		:=		$(_CORE_KANETON_DIR_)/id
_CORE_SEGMENT_DIR_	:=		$(_CORE_KANETON_DIR_)/segment
_CORE_SET_DIR_		:=		$(_CORE_KANETON_DIR_)/set
_CORE_STATS_DIR_	:=		$(_CORE_KANETON_DIR_)/stats

_MACHDEP_BOOTSTRAP_DIR_	:=		$(_CORE_BOOTSTRAP_DIR_)/arch/machdep
_MACHDEP_BOOTLOADER_DIR_:=		$(_CORE_BOOTLOADER_DIR_)/arch/machdep
_MACHDEP_KANETON_DIR_	:=		$(_CORE_KANETON_DIR_)/arch/machdep
_MACHDEP_INCLUDE_DIR_	:=		$(_CORE_INCLUDE_DIR_)/arch/machdep

_LIBS_DIR_		:=		$(_SRC_DIR_)/libs

_ENV_DIR_		:=		$(_SRC_DIR_)/env

_USERS_DIR_		:=		$(_ENV_DIR_)/users
_USER_DIR_		:=		$(_USERS_DIR_)/$(_USER_)

_MACHINES_DIR_		:=		$(_ENV_DIR_)/machines
_MACHINE_		?=						\
  $(shell $(_CAT_) $(_USER_DIR_)/user.conf				| \
          $(_SED_) -n							\
            "s/^_MACHINE_[[:space:]]*\(=\|:=\)[[:space:]]*\(.*\)$$/\2/p")
_MACHINE_DIR_		:=		$(_MACHINES_DIR_)/$(_MACHINE_)

_EXPORT_DIR_		:=		$(_SRC_DIR_)/export
_TOOLS_DIR_		:=		$(_SRC_DIR_)/tools
_VIEW_DIR_		:=		$(_SRC_DIR_)/view

_KLIBC_DIR_		:=		$(_LIBS_DIR_)/klibc
_CRT_DIR_		:=		$(_LIBS_DIR_)/crt

_KLIBC_INCLUDE_DIR_	:=		$(_KLIBC_DIR_)/include

_LDS_DIR_		:=		$(_TOOLS_DIR_)/ld
_MACHDEP_LDS_DIR_	:=		$(_LDS_DIR_)/arch/machdep

_MBI_DIR_		:=		$(_TOOLS_DIR_)/mbi
_PROTO_DIR_		:=		$(_TOOLS_DIR_)/proto

#
# ---------- makefiles dependency ---------------------------------------------
#

_MAKEFILE_MK_		:=		.makefile.mk

#
# ---------- kaneton tools ----------------------------------------------------
#

_PROTO_TOOL_		:=		$(_PROTO_DIR_)/mkp.py

#
# ---------- kaneton scripts --------------------------------------------------
#

_VIEW_SCRIPT_		:=		$(_VIEW_DIR_)/view.sh
_EXPORT_SCRIPT_		:=		$(_EXPORT_DIR_)/export.sh

#
# ---------- kaneton configurations files -------------------------------------
#

_USER_CONF_		:=		$(_USER_DIR_)/user.conf
_USER_MK_		:=		$(_USER_DIR_)/user.mk
_USER_SH_		:=		$(_USER_DIR_)/user.sh
_KANETON_CONF_		:=		$(_USER_DIR_)/kaneton.conf
_MODULES_CONF_		:=		$(_USER_DIR_)/modules.conf

_MACHINE_CONF_		:=		$(_MACHINE_DIR_)/machine.conf
_MACHINE_MK_		:=		$(_MACHINE_DIR_)/machine.mk
_MACHINE_SH_		:=		$(_MACHINE_DIR_)/machine.sh

#
# ---------- conditional compilations from servers ----------------------------
#

_SRC_DEP_		:=						\
  $(shell $(_CAT_) $(_MODULES_CONF_) |					\
          $(_SED_) -n "s/^\([[:alpha:]_-]\+\)\/.*$$/\1/p")

_CORE_DEP_		:=						\
  $(shell $(_CAT_) $(_MODULES_CONF_) |					\
          $(_SED_) -n "s/^core\/\([[:alpha:]_-]\+\)\/.*$$/\1/p")

_DRIVERS_DEP_		:=						\
  $(shell $(_CAT_) $(_MODULES_CONF_) |					\
          $(_SED_) -n "s/^drivers\/\([[:alpha:]_-]\+\)\/.*$$/\1/p")

_SERVICES_DEP_		:=						\
  $(shell $(_CAT_) $(_MODULES_CONF_) |					\
          $(_SED_) -n "s/^services\/\([[:alpha:]_-]\+\)\/.*$$/\1/p")

_PROGRAMS_DEP_		:=						\
  $(shell $(_CAT_) $(_MODULES_CONF_) |					\
          $(_SED_) -n "s/^programs\/\([[:alpha:]_-]\+\)\/.*$$/\1/p")

#
# ---------- kaneton binaries -------------------------------------------------
#

_BOOTSTRAP_		:=		$(_CORE_BOOTSTRAP_DIR_)/bootstrap
_BOOTLOADER_		:=		$(_CORE_BOOTLOADER_DIR_)/bootloader
_KANETON_		:=		$(_CORE_KANETON_DIR_)/kaneton

#
# ---------- kaneton libraries ------------------------------------------------
#

_KLIBC_A_		:=		$(_KLIBC_DIR_)/klibc.a
_CRT_A_			:=		$(_CRT_DIR_)/crt.a

_AS_LO_			:=		$(_CORE_AS_DIR_)/as.lo
_DEBUG_LO_		:=		$(_CORE_DEBUG_DIR_)/debug.lo
_ID_LO_			:=		$(_CORE_ID_DIR_)/id.lo
_SEGMENT_LO_		:=		$(_CORE_SEGMENT_DIR_)/segment.lo
_SET_LO_		:=		$(_CORE_SET_DIR_)/set.lo
_STATS_LO_		:=		$(_CORE_STATS_DIR_)/stats.lo

_MACHDEP_LO_		:=		$(_MACHDEP_KANETON_DIR_)/machdep.lo

#
# ---------- compiler and linker flags ----------------------------------------
#

_INCLUDES_		:=		-I$(_CORE_INCLUDE_DIR_)		\
					-I$(_KLIBC_INCLUDE_DIR_)

_CFLAGS_		:=		-D___kaneton			\
					-nostdinc			\
					-nostdlib			\
					-fno-builtin			\
					-O0				\
					$(_INCLUDES_)			

_LDFLAGS_		:=		-nostdinc			\
					-nostdlib			\
					$(_INCLUDES_)			

_CPPFLAGS_		:=		

_MAKEFLAGS_		:=		
